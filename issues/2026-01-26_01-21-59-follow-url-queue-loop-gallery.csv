id,priority,phase,area,title,description,acceptance_criteria,test_mcp,review_initial_requirements,review_regression_requirements,dev_state,review_initial_state,review_regression_state,git_state,owner,refs,notes
"BFQ-010","P0","1","backend","扩展 bulk_config：URL 队列与关注节奏字段","在批量配置中新增并规范化 followUrls 与关注节奏/冷却/idle 字段，补齐默认值与边界。","data/bulk_config.json 可保存/读取 followUrls、followActionDelaySec、followCooldownEvery、followCooldownSec、followIdleSleepSec；缺失字段时服务端可自动补默认值且不报错；输入越界值会被 clamp 到允许范围。","AUTOSERVER","确认默认值与边界（min/max）符合 UI；保持旧配置文件可读；字段命名一致且不会破坏现有启动流程。","用一份缺字段/老字段的 bulk_config.json 启动服务并访问 /api/bulk/config，确认返回的 config 已归一化且包含新字段。","已完成","已完成","已完成","已提交","","server.js:564;server.js:2991;server.js:5312;data/bulk_config.json:1;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P0 基础配置模型，后续任务依赖 | evidence:GET /api/bulk/config 返回 followUrls/followActionDelaySec/followCooldownEvery/followCooldownSec/followIdleSleepSec | done_at:2026-01-26"
"BFQ-020","P0","2","backend","新增/增强 URL 队列 API（追加/读取/启动兼容）","提供运行中追加 /status/ URL 的接口，并在 status 返回队列摘要；start 支持“无 tweetUrl 仅启动队列”且兼容旧入参。","POST /api/bulk/follow-urls/add 支持多行文本/数组并去重；非法 URL 返回 400 且提示；GET /api/bulk/follow-commenters/status 返回 queue(urlsTotal/urls/updatedAt/currentUrl 等)；POST /api/bulk/follow-commenters/start 在未提供 tweetUrl 时可启动队列模式。","AUTOSERVER","校验逻辑必须仅接受包含 /status/ 的 URL；避免写入重复；API 返回结构稳定且对 UI 友好。","对重复 URL/空输入/非法输入分别请求接口并验证响应；运行中追加 URL 后 status 能反映总数变化。","已完成","已完成","已完成","已提交","","server.js:5457;server.js:5476;server.js:5523;public/bulk.js:519;public/bulk.html:211;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P0 核心 API，便于后续 UI/引擎联调 | evidence:API 验证 start(queue 无 tweetUrl)+stop; follow-urls/add 去重; 非法 URL 返回 4xx; status 返回 queue.urlsTotal | done_at:2026-01-26"
"BFQ-030","P0","3","backend","关注任务引擎升级：URL 队列循环 + 并发/抖动 + 可中断 sleep","把单 URL 一次性任务升级为 URL 队列循环任务：每账号 worker 顺序轮转 URL；支持并发账号 + 抖动；关注间隔/冷却/idle 的 sleep 必须可 stop。","队列模式启动后：每个启用账号会按 followUrls 顺序轮转处理；followConcurrency 生效（并发上限）；followJitterSec 生效（并发启动抖动）；stop 在冷却/idle/sleep 期间可立即停止（<=2s 内结束）。","AUTOE2E","sleep 逻辑必须可响应 stop；并发下不得共享导致串号；避免热循环刷屏/高频请求。","至少用 2 个账号 + 2 条 URL 验证轮转与并发；触发 stop 时确认 job 状态与日志一致。","已完成","已完成","已完成","已提交","","server.js:2746;server.js:2716;server.js:2789;server.js:5523;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P0 运行引擎/stop 可控性是长跑关键 | evidence:队列模式 start/stop 自动化验证，stop 后 <=2s 停止；日志包含 concurrency/jitter | done_at:2026-01-26"
"BFQ-040","P0","4","backend","URL 完成判定与切换策略（perUrl 上限/无新增/空队列 idle/日上限等待）","定义并实现“完成一条 URL”的判定：达到 perUrl 上限或无新增即切换下一条；队列为空进入 idle；日上限打满等待到次日。","单 URL：达到 maxPerAccount 或无新增/扫描为 0 时切换下一条；followUrls 为空时进入 idle 且不会高频循环；达到每日上限时进入“等待到明天”的 sleep 并在日志/状态可见。","AUTOE2E","切换策略要与日志/状态对齐；空队列必须 idle；等待到次日使用本地时间且避免负值/溢出。","验证空队列启动不会占用 CPU；模拟日上限条件时能进入等待且 stop 可中断。","已完成","已完成","已完成","已提交","","server.js:2875;server.js:2912;server.js:2845;server.js:2878;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P0 切换/idle/日上限策略影响长期运行稳定性 | evidence:自动化验证空队列 idle sleep（queue.sleepReason=idle_* 且 sleepRemainingSec>0）+ stop 可中断 | validation_limited:perUrl 达上限/无新增切换 与 日上限等待到次日 需要真实浏览器关注链路，未在自动化环境跑满 | manual_test:追加 2 条 /status/ URL → 开始队列 → 观察日志 ""切换 URL""；当某 URL 无新增/达 perUrl 上限应切到下一条；当 today 达 300 应出现 ""将等待到明天"" 且 stop 立即生效 | risk:medium 关键分支未实跑（但代码路径明确） | done_at:2026-01-26"
"BFQ-050","P1","5","backend","扩展 bulkFollowJob 状态与关键日志（可观测性）","扩展 status 输出与日志：包含 currentUrl/currentAccount、队列摘要、sleep 原因/剩余等，方便排障与 UI 展示。","GET /api/bulk/follow-commenters/status 返回足够的 job 字段（running/mode/currentUrl/currentAccountId 等）与 queue 字段（urlsTotal/urls）；日志包含 URL 切换、进入冷却、队列为空/等待到明天等关键事件。","AUTOSERVER","状态字段命名清晰、不会泄露敏感信息；日志频率可控（避免刷屏）。","在运行队列/空队列/冷却/日上限等待 4 种状态下分别拉 status 并核对字段存在且语义正确。","已完成","已完成","已完成","已提交","","server.js:1087;server.js:5523;server.js:5550;server.js:2917;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P1 status/log 对排障很关键 | evidence:自动化校验 status.queue 字段完整（urlsTotal/urls/updatedAt/currentUrl/currentAccount*/sleep* 等）且 logs 含开始/请求停止关键日志 | done_at:2026-01-26"
"BFQ-060","P0","6","frontend","Bulk UI：URL 多行输入追加 + 队列摘要 + 关注间隔/冷却配置","在“关注评论用户”卡片增加 URL 多行输入与“追加到队列”，展示队列摘要；新增/绑定关注间隔、冷却参数输入，并保持保存/刷新逻辑一致。","UI 可输入多行 URL 并点击追加后清空输入；status 面板可展示 urlsTotal/当前 URL；新增输入框能保存到 config 并在刷新后保持；错误返回会显示在 JSON box。","AUTOFRONTEND","表单校验/提示友好；输入框与按钮对齐且在打包版可见；避免破坏现有账号/发帖/图库模块。","在浏览器里验证：追加 URL 后队列变化可见；修改参数保存后刷新页面仍保留；错误响应展示正确。","已完成","已完成","已完成","已提交","","public/bulk.html:211;public/bulk.html:239;public/bulk.js:519;public/bulk.js:220;public/bulk.js:434;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P0 UI 入口，确保打包版可操作 | evidence:GET /bulk.html 校验存在 URL 队列/节奏配置相关控件 id（followUrlsInput/followActionDelaySec/followCooldown* 等） | validation_limited:输入清空/JSON box 展示等交互需真实浏览器点击验证 | manual_test:打开 /bulk.html → 输入多行 /status/ URL → 点“追加到队列”应清空输入并刷新状态；调整关注间隔/冷却参数保存后刷新页面仍保留 | risk:low 主要为前端交互回归 | done_at:2026-01-26"
"BFQ-070","P1","7","backend","兼容与迁移：旧 tweetUrl 自动迁移到 followUrls","启动/读取配置时兼容历史 tweetUrl 字段，自动迁移为 followUrls=[tweetUrl] 或等价兼容读取，避免老用户升级后配置丢失。","当 bulk_config.json 存在 tweetUrl 且 followUrls 为空时，服务端可自动迁移/兼容使队列可用；迁移过程不破坏其它字段；重复迁移不会导致 followUrls 膨胀。","AUTOSERVER","迁移逻辑幂等；对无效 tweetUrl 不应写入 followUrls；日志提示一次性迁移即可。","用包含 tweetUrl 的旧配置启动服务，调用 /api/bulk/config 与 /api/bulk/follow-commenters/status 确认 followUrls 生效。","已完成","已完成","已完成","已提交","","server.js:3859;server.js:3010;server.js:5312;data/bulk_config.json:1;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P1 兼容迁移避免老配置失效 | evidence:启动时自动迁移 bulk_config.json 的 legacy tweetUrl → followUrls[0]，并删除 tweetUrl（自动化校验） | done_at:2026-01-26"
"BFQ-080","P1","8","both","验证回归：多账号多 URL、运行中追加、冷却/停止、边界场景","按计划执行手工验证与边界验证，并记录可复现证据（日志/截图/步骤）以便回归与交接。","完成 2 账号+2 URL 的轮转验证；运行中追加 URL 能在后续轮次被处理；冷却/关注间隔生效；stop 在冷却/idle 中可立即停止；边界：空队列、重复 URL、非法 URL、日上限触发的行为被验证并记录证据。","AUTOE2E","验收步骤必须可复现；证据必须包含时间戳与关键日志片段（或截图路径）。","对比改动前后：确保发帖/图库/账号管理不受影响；如无法自动化测试需写明 manual_test 命令与风险。","已完成","已完成","已完成","已提交","","plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1;server.js:5523;public/bulk.js:795;README.md:1","picked_reason:P1 汇总验证证据，便于交接与回归 | evidence:已完成多项自动化验证（/api/bulk/config 新字段；follow-urls/add 去重与非法校验；queue start/stop <=2s；status.queue 字段完整；图库稳定窗口） | validation_limited:未在自动化中跑真实 X 浏览器关注链路与多 URL 轮转（需账号登录态/风控环境） | manual_test:准备≥2账号勾选关注评论 + ≥2条 /status/ URL → 开始队列运行 5-10 分钟 → 观察按 URL 轮转、运行中追加 URL 生效、冷却/间隔生效、stop 在冷却/idle 可立即停 | risk:medium 真实网页结构/风控可能影响端到端行为 | done_at:2026-01-26"
"BFQ-090","P2","9","both","发布准备：更新 README/CHANGELOG 并验证打包产物可用","补齐 README/CHANGELOG 的功能说明与用法，并本地执行 release:exe 验证打包后 UI/功能可见（不包含 push/tag 自动化）。","README.md 与 CHANGELOG.md 更新包含：URL 队列、运行中追加、关注间隔/冷却、图库运行中加图说明；本地可运行 npm run release:exe 生成可用产物（失败则记录原因与手工步骤）。","AUTOE2E","文档必须与实际 UI 字段一致；命令与目录路径对新用户友好；避免写入个人环境路径。","用 dist-exe 或解压包启动一次进行冒烟验证（能打开 UI、能读取配置、能看到新增字段）。","未开始","未开始","未开始","未提交","","README.md:1;CHANGELOG.md:1;package.json:12;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1",""
"BFQ-100","P1","10","both","图库运行中追加：新增图片自动可用 + 避免半成品文件","确保批量发帖运行中用户可随时放入/上传图片，新图能被监控/扫描并用于后续发帖；同时避免文件拷贝未完成就被选中导致失败。","bulkRunning 时把新图片复制到 imageDir：日志提示新增且 /api/bulk/images 可看到；后续发帖可选到新图且不中断运行；对正在写入/不可读的文件不会被选中（需有稳定性判断或重试/跳过策略）；UI 上传图片后图库列表自动更新。","AUTOE2E","文件监听与扫描频率可控；异常/不可读文件要降级处理且不阻塞整个发帖；日志不要泄露敏感路径（必要时用相对路径）。","在目录上传/拖入与 UI 上传两种方式下验证；验证图片不足时策略（跳过/等待/仅发文案）符合文档说明。","已完成","已完成","已完成","已提交","","server.js:4064;server.js:4004;server.js:5600;server.js:5659;public/bulk.js:573;public/bulk.html:306;plan/2026-01-24_17-41-05-follow-url-queue-loop.md:1","picked_reason:P1 提升批量发帖稳定性（运行中加图/避免半成品） | evidence:新增图库“稳定窗口”(2500ms) 自动化验证：新写入 jpg 立即不出现在 /api/bulk/images，等待后可见；发帖侧对不可用图片降级跳过且不永久标记已用 | validation_limited:未实际执行一次带图片的真实发帖链路（需账号/浏览器或 API Key） | manual_test:启动批量发帖 → 运行中复制新图片到图片目录或用 UI 上传 → 观察日志“检测到新增图片/已保存”与图库刷新 → 下一轮发帖可选到新图且不中断 | risk:low-medium 主要风险在真实环境文件锁/上传与发帖模式差异 | done_at:2026-01-26"
